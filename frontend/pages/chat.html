<?php
session_start();
require_once '../../backend/chat.php';
require_once '../../backend/user.php';
$user = new User();
$c = new Chat();
$chats = $c->get_chat_list($_SESSION['user_id']);
?>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/391827d54c.js" crossorigin="anonymous"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../style/chat.css">
    <link rel="stylesheet" href="../style/scrollbar_set.css">
    <script type="text/javascript" src="../script/chat_behaviour.js"></script>
    <title>Artify chat</title>
</head>

<body>
    <p id="user_id" hidden>
        <?php echo $_SESSION['user_id']; ?>
    </p>
    <div class="main-container">
        <div class="left-container">

            <!--header -->
            <div class="header">
                <div class="header-container">
                    <a href="<?php echo $_SESSION['device']; ?>">
                        <img src="../img/logo.png" alt="logo" class="header-logo">
                    </a>
                </div>
            </div>

            <!-- search-container -->
            <div class="search-container">
                <div class="input">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" placeholder="Search or start new chat   ">
                </div>
            </div>


            <!--chats -->
            <div class="chat-list">
                <?php foreach($chats as $chat): ?>
                <div class="chat-box">
                    <span class="img-box">
                        <?php $profileP = $user->getProfileImg($chat[0]);?>
                    </span>
                    <div class="chat-details">
                        <?php $prev = $c->get_last_message($chat[0], $_SESSION['user_id']); ?>
                        <div class="text-head">
                            <h4 id="chat-user">
                                <?php echo $chat[1] . ' #' . $chat[0]; ?>
                            </h4>
                            <?php $x = date_parse($prev[1]); ?>
                            <p class="time">
                                "
                                <?php echo $x['hour'] . ':' . $x['minute']; ?>"
                            </p>
                            <!-- <b class="unread"></b> -->
                        </div>
                        <div class="text-message">
                            <p>“
                                <?php echo substr($prev[0], 0, 22); ?>”
                            </p>
                            <!-- <b></b> -->
                        </div>
                    </div>
                </div>
                <?php endforeach; ?>
            </div>

        </div>
        <div class="right-container invisible">
            <!--header -->
            <div class="header">
                <div class="img-text">
                    <div class="user-img">
                    </div>
                    <h4 id="receiver_username"></h4>
                </div>
                <div class="return-button">
                    <i class="fa-lg fa-solid fa-rotate-left"></i>
                </div>
            </div>

            <!--chat-container -->
            <div class=" chat-container">
            </div>

            <!--input-bottom -->
            <div class="chatbox-input hidden">
                <form class="chatbox-form" action="#">
                    <input type="text" placeholder="Type a message" name="message" class="input-message">
                    <button type="submit" class="message-button" value="">
                        <i class="fa-lg fa-regular fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>

    </div>
</body>

</html>